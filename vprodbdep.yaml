apiVersion: app/latest
kind: Deployment
metadata:
  name: vprofiledb
  labels:
    app: vprofiledb
spec:
  selector:
    matchLabels:
      app: vprofiledb
    replicas: 1
    template:
      metadata:
        labels:
          app: vprofiledb
      spec:
        containers:
          - name: vprofiledb
            image: maganahalli/vprofiledb:latest
            volumeMounts:
              - mountPath: /var/lib/mysql
                name: vpro-db-data
            ports:
              - name: vprodb-port
                containerPort: 3306
            env:
              - name: MYSQL_ROOT_PASSWORD
                valueFrom:
                  secretKeyRef:
                    name: app-secret
                    key: db-pass
        nodeSelector:
           zone: us-east-1a

        volume:
          - name: vpro-db-data
            awsElasticBlockStore:
              volumeID: vol-04b8ae788e6115e60
              fsType: ext4

        initContainers:
          - name: busybox
            image: busybox:latest
            args: ["rm"," -rf","/var/lib/mysql/lost+found"]
            volumeMounts:
              - name: vpro-db-data
                mountPath: /var/lib/mysql



